package v1;

import java.io.IOException;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
import java.util.TreeMap;

import org.jsoup.*;
import org.jsoup.nodes.*;
import org.jsoup.select.*;

public class TestJSOUP 
{
	private final String SITE = "https://fr.investing.com/indices/major-indices";
	//-----------------------------------
	private HashMap<String,Indice> indices;
	
	public TestJSOUP() throws IOException, InterruptedException
	{
		indices = new HashMap<String,Indice>();
		Connection c = Jsoup.connect(SITE).ignoreHttpErrors(true);
		Document d = c.get();
		
		Elements tables = d.select("table");
		Elements lignes = tables.get(0).select("tr");
		for(Element ligne:lignes)
		{
			Elements colonnes = ligne.select("td");
			List<String> tmp = colonnes.eachText();
			if(tmp.size()>0)
			{
				String nom = tmp.get(1);
				double val = Double.parseDouble(tmp.get(2).replaceAll("\\.", "").replaceAll(",","."));
				indices.put(nom,new Indice(val,nom));
			}
		}
		
		int i=0;
		try
		{
			while(true)
			{
				System.out.print(i++);
				Thread.sleep(1000);
				d = c.get();
				
				tables = d.select("table");
				lignes = tables.get(0).select("tr");
				for(Element ligne:lignes)
				{
					Elements colonnes = ligne.select("td");
					List<String> tmp = colonnes.eachText();
					if(tmp.size()>0)
					{
						String nom = tmp.get(1);
						double val = Double.parseDouble(tmp.get(2).replaceAll("\\.", "").replaceAll(",","."));
						indices.get(nom).addVal(val);
					}
				}
			}
		}
		catch(Exception e) {e.printStackTrace();}
	}
	
	private void afficher()
	{
		Map<String,Indice> s2 = new TreeMap<String,Indice>(indices);
		Iterator<String> it = s2.keySet().iterator();while(it.hasNext()) {s2.get(it.next()).show();}
	}
	
	public static void main(String[] args) throws IOException, InterruptedException
	{
		TestJSOUP jsoup = new TestJSOUP();
	}
}
