package v1;

import java.io.*;
import java.net.*;
import java.util.*;

public class LauncherSIMUL 
{
	private final String SITE = "https://fr.investing.com/indices/major-indices";
	
	private ArrayList<String> tab,lignesNonFormat;
	private HashMap<String,Indice> indices;
	private String doc;
	//----------------------------------------
	private URLConnection openConnection;
	
	public LauncherSIMUL() throws IOException, InterruptedException
	{
		read();
		getTab();
		getLignes();
		formatLignes();
		alimenter();
	}
	
	private void read() throws IOException
	{
		StringBuilder sbDoc = new StringBuilder();String tmp;
		try 
		{ 
			openConnection = new URL(SITE).openConnection();
			openConnection.addRequestProperty("User-Agent", "Mozilla/5.0 (Windows NT 6.1; WOW64; rv:25.0) Gecko/20100101 Firefox/25.0");
			
			InputStream is		 	= openConnection.getInputStream();
			InputStreamReader isr 	= new InputStreamReader(is,"UTF-8");
			BufferedReader in 		= new BufferedReader(isr); 
		 	
		 	while ((tmp=in.readLine())!=null) {sbDoc.append(tmp);} 
		 	is.close();
		} 
		catch (MalformedURLException e) {e.printStackTrace();} catch (IOException e) {e.printStackTrace();}
		doc = sbDoc.toString();
		doc = doc.substring(doc.indexOf("<table"));
	}
	private void read2() throws IOException
	{
		StringBuilder sbDoc = new StringBuilder();String tmp;
		try 
		{ 
			InputStream is 			= openConnection.getInputStream();
			InputStreamReader isr	= new InputStreamReader(is,"UTF-8");
			BufferedReader in 		= new BufferedReader(isr); 
			
		 	while ((tmp=in.readLine())!=null) {sbDoc.append(tmp);}   
		 	is.close();
		} 
		catch (MalformedURLException e) {e.printStackTrace();} catch (IOException e) {e.printStackTrace();}
		doc = sbDoc.toString();
		System.out.println(doc);
		doc = doc.substring(doc.indexOf("<table"));
	}
	private void afficher()
	{
		Map<String,Indice> s2 = new TreeMap<String,Indice>(indices);
		Iterator<String> it = s2.keySet().iterator();while(it.hasNext()) {s2.get(it.next()).show();}
	}
	private void alimenter() throws InterruptedException, IOException
	{
		int cpt = 0;
		while(cpt++<2)
		{
			System.out.print(cpt+" ");
			Thread.sleep(1000);
			read2();
			getTab();
			getLignes();
			formatLignes2();
		}
		afficher();
	}
	public static void main(String[] args) throws IOException, InterruptedException{LauncherSIMUL l = new LauncherSIMUL();}
}
